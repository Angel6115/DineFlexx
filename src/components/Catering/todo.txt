=== CATERINGFLEXX.JSX ===
// src/components/Catering/CateringFlexx.jsx

import React, { useEffect, useState } from "react";
import supabase from "../../supabaseClient";
import { Card, CardContent } from "../ui/card";
import { Button } from "../ui/button";
import { useNavigate } from "react-router-dom";
import CateringDetalle from "./CateringDetalle"; // ‚úÖ Importaci√≥n correcta

const CateringFlexx = () => {
  const [servicios, setServicios] = useState([]);
  const navigate = useNavigate();

  useEffect(() => {
    const fetchServicios = async () => {
      const { data, error } = await supabase
        .from("catering_services")
        .select("*");

      if (error) {
        console.error("Error al cargar servicios:", error.message);
      } else {
        setServicios(data);
      }
    };

    fetchServicios();
  }, []);

  return (
    <div className="min-h-screen px-4 py-10 md:px-20 bg-white">
      <h1 className="text-3xl font-bold text-center mb-8 text-blue-900">
        Servicios de Catering
      </h1>

      <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {servicios.map((servicio) => (
          <Card key={servicio.id} className="shadow-md">
            <CardContent className="p-4 space-y-2">
              <img
                src={servicio.image_url || "/images/default-catering.jpg"}
                alt={servicio.title}
                className="w-full aspect-[4/3] object-cover rounded"
              />
              <h2 className="text-xl font-semibold text-blue-800">
                {servicio.title}
              </h2>
              <p className="text-sm text-gray-600">{servicio.description}</p>
              <p className="text-green-700 font-semibold">
                Desde ${servicio.price}
              </p>
              <p className="text-sm text-gray-500">
                Hasta {servicio.max_installments} cuotas disponibles
              </p>

              {/* ‚úÖ Aqu√≠ mostramos el men√∫ detallado si existe */}
              <div className="mt-2">
                <CateringDetalle tipo={servicio.title} />
              </div>

              <Button
                className="w-full bg-blue-700 hover:bg-blue-800 text-white mt-2"
                onClick={() => navigate(`/catering/solicitar/${servicio.id}`)}
              >
                Solicitar este servicio
              </Button>
            </CardContent>
          </Card>
        ))}
      </div>

      {servicios.length === 0 && (
        <p className="text-center text-gray-500 mt-10">
          No hay servicios de catering disponibles en este momento.
        </p>
      )}
    </div>
  );
};

export default CateringFlexx;
\n\n=== CATERINGDETALLE.JSX ===
// src/components/Catering/CateringDetalle.jsx
import React from "react";
import { motion } from "framer-motion";
import { 
  Briefcase, 
  Heart, 
  Coffee, 
  GraduationCap 
} from "lucide-react";

const ICONS = {
  "Catering Corporativo": Briefcase,
  "Catering para Bodas": Heart,
  "Catering para Brunch": Coffee,
  "Catering para Graduaciones": GraduationCap,
};

const menus = {
  "Catering Corporativo": {
    descripcion:
      "Ideal para reuniones de negocios con bandejas ejecutivas, desayunos y coffee breaks.",
    incluye: [
      "Bandejas ejecutivas con variedad de s√°ndwiches",
      "Desayunos calientes y fr√≠os",
      "Coffee breaks con caf√© premium",
      "Opciones saludables y veganas",
    ],
    color: "from-blue-500 to-indigo-600",
    bgColor: "bg-gradient-to-r from-blue-50 to-indigo-50",
    borderColor: "border-blue-200 ring-blue-100",
  },
  "Catering para Bodas": {
    descripcion:
      "Servicio elegante para bodas, con men√∫ personalizado y decoraci√≥n especial.",
    incluye: [
      "Men√∫ gourmet personalizado",
      "Decoraci√≥n floral",
      "M√∫sica ambiental",
      "Servicio de fotograf√≠a",
    ],
    color: "from-rose-500 to-pink-600",
    bgColor: "bg-gradient-to-r from-rose-50 to-pink-50",
    borderColor: "border-rose-200 ring-rose-100",
  },
  "Catering para Brunch": {
    descripcion:
      "Brunch delicioso para celebraciones matutinas con variedad de opciones frescas.",
    incluye: [
      "Variedad de panes y boller√≠a",
      "Jugos naturales y caf√©",
      "Platos fr√≠os y calientes",
      "Opciones vegetarianas",
    ],
    color: "from-orange-500 to-amber-600",
    bgColor: "bg-gradient-to-r from-orange-50 to-amber-50",
    borderColor: "border-orange-200 ring-orange-100",
  },
  "Catering para Graduaciones": {
    descripcion:
      "Celebra con un men√∫ especial para eventos de graduaci√≥n con servicio completo.",
    incluye: [
      "Buffet con platos calientes y fr√≠os",
      "Decoraci√≥n tem√°tica de graduaci√≥n",
      "Pastel personalizado",
      "Bebidas no alcoh√≥licas y snacks",
    ],
    color: "from-purple-500 to-violet-600",
    bgColor: "bg-gradient-to-r from-purple-50 to-violet-50",
    borderColor: "border-purple-200 ring-purple-100",
  },
};

export default function CateringDetalle({ tipo, esVIP }) {
  const menu = menus[tipo];
  if (!menu) return null;

  const Icon = ICONS[tipo] || Briefcase;

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      whileInView={{ opacity: 1, y: 0 }}
      whileHover={{ y: -4, scale: 1.02 }}
      transition={{ type: "spring", stiffness: 300 }}
      className={`
        mb-6 p-6 rounded-2xl shadow-lg transition-all duration-300 hover:shadow-2xl
        border-2 ${esVIP ? "border-teal-400 ring-2 ring-teal-100/50" : "border-gray-100 ring-1 ring-gray-50/50"}
        ${esVIP ? "bg-gradient-to-br from-teal-50 to-emerald-50" : menu.bgColor}
        md:p-8 md:mb-8
        group
      `}
      role="article"
      aria-labelledby={`menu-${tipo}-title`}
    >
      {/* Header con √≠cono */}
      <div className="flex items-start gap-4 mb-6">
        <motion.div
          whileHover={{ rotate: 360, scale: 1.1 }}
          className={`
            flex-shrink-0 w-14 h-14 p-3 rounded-2xl shadow-md
            ${esVIP ? "bg-gradient-to-r from-teal-500 to-emerald-500 text-white" : `bg-gradient-to-r ${menu.color} text-white`}
            group-hover:scale-110 transition-all
          `}
        >
          <Icon className="w-7 h-7" aria-hidden="true" />
        </motion.div>

        <div className="flex-1 min-w-0">
          <h3 
            id={`menu-${tipo}-title`}
            className={`
              text-xl md:text-2xl font-bold mb-2 leading-tight
              ${esVIP ? "text-teal-900" : "text-gray-900"}
              group-hover:text-gray-800
            `}
          >
            {tipo}
            {esVIP && (
              <span className="ml-2 inline-flex items-center gap-1 px-3 py-1 bg-teal-100 text-teal-800 text-sm font-semibold rounded-full ring-1 ring-teal-200">
                <span className="w-1.5 h-1.5 bg-teal-500 rounded-full" />
                VIP Exclusivo
              </span>
            )}
          </h3>
          
          <p className="text-gray-700 leading-relaxed mb-6 line-clamp-3">
            {menu.descripcion}
          </p>
        </div>
      </div>

      {/* Lista de inclusiones */}
      <ul className="space-y-3 mb-6">
        {menu.incluye.map((item, index) => (
          <motion.li
            key={item}
            initial={{ opacity: 0, x: -20 }}
            whileInView={{ opacity: 1, x: 0 }}
            transition={{ delay: index * 0.05 }}
            className="flex items-start gap-3 p-3 bg-white/60 backdrop-blur-sm rounded-xl border-l-4 
                       border-gray-200 group-hover:border-gray-300 transition-all"
          >
            <div className="flex-shrink-0 w-2 h-2 bg-gradient-to-r from-gray-400 to-gray-600 mt-2 rounded-full group-hover:scale-125" />
            <span className="text-sm leading-relaxed text-gray-700">{item}</span>
          </motion.li>
        ))}
      </ul>

      {/* Mensaje VIP */}
      {esVIP && (
        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          whileInView={{ opacity: 1, scale: 1 }}
          className="p-4 bg-gradient-to-r from-teal-500/10 to-emerald-500/10 border border-teal-200/50 
                     rounded-xl backdrop-blur-sm"
        >
          <p className="text-teal-900 font-semibold flex items-center gap-2">
            ‚ú® <span>¬°Gracias por ser usuario VIP! Disfruta beneficios exclusivos como delivery prioritario y men√∫ personalizado.</span>
          </p>
        </motion.div>
      )}
    </motion.div>
  );
}
\n\n=== CATERINGRESUMEN.JSX ===
import React from "react";
import jsPDF from "jspdf";

export default function CateringResumen({ solicitud }) {
  const generarPDF = () => {
    const doc = new jsPDF();

    // Ruta relativa al logo en carpeta public/images
    const logoPath = "/images/dlog1.png";

    // Funci√≥n para convertir imagen a base64 usando canvas
    const cargarImagenBase64 = (url) => {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "Anonymous"; // Para evitar problemas CORS
        img.onload = () => {
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);
          const dataURL = canvas.toDataURL("image/png");
          resolve(dataURL);
        };
        img.onerror = reject;
        img.src = url;
      });
    };

    cargarImagenBase64(logoPath)
      .then((imgData) => {
        // Insertar logo tama√±o 90x30 mm
        doc.addImage(imgData, "PNG", 15, 10, 90, 30);

        // T√≠tulo
        doc.setFontSize(16);
        doc.setFont("helvetica", "bold");
        doc.text("Solicitud para Catering Corporativo", 15, 50);

        doc.setFontSize(12);
        doc.setFont("helvetica", "normal");

        let currentY = 60;
        const lineHeight = 10;

        // Funci√≥n para escribir etiqueta y valor
        const agregarTexto = (label, valor) => {
          doc.setFont("helvetica", "bold");
          doc.text(`${label}:`, 15, currentY);
          doc.setFont("helvetica", "normal");
          doc.text(`${valor}`, 60, currentY);
          currentY += lineHeight;
        };

        agregarTexto("Nombre", solicitud.nombre);
        agregarTexto("Email", solicitud.email);
        agregarTexto("Tel√©fono", solicitud.telefono);
        agregarTexto("Evento", solicitud.evento);
        agregarTexto("Direcci√≥n", solicitud.direccion);
        agregarTexto("Fecha", solicitud.fecha);
        agregarTexto("Hora", solicitud.hora);
        agregarTexto("N√∫mero de invitados", solicitud.personas);
        agregarTexto("M√©todo de pago", solicitud.metodo_pago);
        agregarTexto("Servicios adicionales", solicitud.servicios_adicionales || "Ninguno");
        agregarTexto("Precio base", `$${solicitud.precio_base.toFixed(2)}`);
        agregarTexto("Total extras", `$${solicitud.total_extras.toFixed(2)}`);
        agregarTexto("Total general", `$${solicitud.total_general.toFixed(2)}`);
        agregarTexto("Cr√©dito restante", `$${solicitud.credito_restante.toFixed(2)}`);
        agregarTexto("Cuotas", solicitud.cuotas);

        // L√≠nea divisoria
        doc.setDrawColor(0, 0, 0);
        doc.setLineWidth(0.5);
        doc.line(15, currentY, 195, currentY);
        currentY += 10;

        // Pie de p√°gina con fecha actual
        const fechaActual = new Date().toLocaleDateString();
        doc.setFontSize(10);
        doc.text(`Generado el: ${fechaActual}`, 15, currentY);

        // Guardar PDF
        doc.save("solicitud_catering.pdf");
      })
      .catch((error) => {
        console.error("Error cargando el logo para el PDF:", error);
        alert("Error al cargar el logo para el PDF.");
      });
  };

  return (
    <div
      style={{
        padding: 20,
        fontFamily: "Arial, sans-serif",
        maxWidth: 600,
        margin: "0 auto",
        backgroundColor: "#f9f9f9",
        borderRadius: 8,
        boxShadow: "0 2px 8px rgba(0,0,0,0.1)",
      }}
    >
      <button
        onClick={generarPDF}
        style={{
          backgroundColor: "#1a73e8",
          color: "white",
          padding: "12px 20px",
          borderRadius: 6,
          border: "none",
          fontWeight: "bold",
          cursor: "pointer",
          marginBottom: 20,
          fontSize: 16,
        }}
      >
        Generar PDF con Logo Mejorado
      </button>

      <div>
        <h3 style={{ borderBottom: "2px solid #1a73e8", paddingBottom: 8, marginBottom: 20 }}>
          Resumen de Solicitud
        </h3>
        <p><b>Nombre:</b> {solicitud.nombre}</p>
        <p><b>Email:</b> {solicitud.email}</p>
        <p><b>Tel√©fono:</b> {solicitud.telefono}</p>
        <p><b>Evento:</b> {solicitud.evento}</p>
        <p><b>Direcci√≥n:</b> {solicitud.direccion}</p>
        <p><b>Fecha:</b> {solicitud.fecha}</p>
        <p><b>Hora:</b> {solicitud.hora}</p>
        <p><b>N√∫mero de invitados:</b> {solicitud.personas}</p>
        <p><b>M√©todo de pago:</b> {solicitud.metodo_pago}</p>
        <p><b>Servicios adicionales:</b> {solicitud.servicios_adicionales || "Ninguno"}</p>
        <p><b>Precio base:</b> ${solicitud.precio_base.toFixed(2)}</p>
        <p><b>Total extras:</b> ${solicitud.total_extras.toFixed(2)}</p>
        <p><b>Total general:</b> ${solicitud.total_general.toFixed(2)}</p>
        <p><b>Cr√©dito restante:</b> ${solicitud.credito_restante.toFixed(2)}</p>
        <p><b>Cuotas:</b> {solicitud.cuotas}</p>
      </div>
    </div>
  );
}
\n\n=== CATERINGSOLICITUDFORM.JSX ===
import React, { useState, useEffect, useRef } from "react";
import { motion } from "framer-motion";
import { AnimatePresence } from "framer-motion";
import { useNavigate, useParams } from "react-router-dom";
import { 
  User, Mail, Phone, Calendar, Clock, Users, MapPin, 
  CreditCard, FileText, CheckCircle, Download, ArrowLeft, AlertCircle 
} from "lucide-react";
import supabase from "../../supabaseClient";
import jsPDF from "jspdf";

const tiposDeCatering = {
  "Cumplea√±os": {
    servicios: [
      { nombre: "Decoraci√≥n especial", precio: 150 },
      { nombre: "Postres personalizados", precio: 180 },
    ],
    menu: [
      { nombre: "Men√∫ B√°sico", precio: 25, descripcion: "Hamburguesas, hot dogs, ensalada y bebidas" },
      { nombre: "Men√∫ Premium", precio: 40, descripcion: "Pasta, carnes, ensaladas gourmet y postres" }
    ],
    icon: "üéâ",
    color: "from-pink-500 to-rose-500"
  },
  "Corporativo": {
    servicios: [
      { nombre: "M√∫sica / DJ", precio: 200 },
      { nombre: "Servicio de meseros", precio: 100 },
    ],
    menu: [
      { nombre: "Desayuno Ejecutivo", precio: 20, descripcion: "Frutas, panes, huevos y caf√©" },
      { nombre: "Almuerzo de Negocios", precio: 35, descripcion: "Plato principal, ensalada, postre y bebidas" }
    ],
    icon: "üíº",
    color: "from-blue-500 to-indigo-500"
  },
  "Boda": {
    servicios: [
      { nombre: "Decoraci√≥n especial", precio: 150 },
      { nombre: "Bebidas premium", precio: 120 },
      { nombre: "Servicio de meseros", precio: 100 },
    ],
    menu: [
      { nombre: "Men√∫ Cl√°sico", precio: 45, descripcion: "Entrada, plato principal y postre tradicional" },
      { nombre: "Men√∫ Gourmet", precio: 65, descripcion: "Platos gourmet con opciones vegetarianas y veganas" }
    ],
    icon: "üíç",
    color: "from-purple-500 to-pink-500"
  }
};

const creditoInicial = 1500;

export default function CateringSolicitudForm() {
  const navigate = useNavigate();
  const { id } = useParams();
  const direccionInputRef = useRef(null);
  const autocompleteRef = useRef(null);

  const [form, setForm] = useState({
    nombre: "", email: "", telefono: "", tipo: "", fecha: "", hora: "",
    personas: "", direccion: "", metodo_pago: "Tarjeta de cr√©dito", cuotas: 1,
    notas: "", servicios_adicionales: [], menu_seleccionado: null,
    contacto_emergencia: "", telefono_emergencia: "", 
    instrucciones_entrega: "", alergias: ""
  });
  
  const [errores, setErrores] = useState({});
  const [creditoTotal] = useState(creditoInicial);
  const [loading, setLoading] = useState(false);
  const [confirmado, setConfirmado] = useState(false);
  const [googleLoaded, setGoogleLoaded] = useState(false);
  const [mostrarResumen, setMostrarResumen] = useState(false);
  const [step, setStep] = useState(0);

  useEffect(() => {
    if (window.google?.maps) { setGoogleLoaded(true); return; }
    const script = document.createElement("script");
    script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyCcotv_0G8ETQb-7i25p36Ean0aOOrquOs&libraries=places";
    script.async = true;
    script.onload = () => setGoogleLoaded(true);
    document.head.appendChild(script);
    return () => { if (script.parentNode) script.parentNode.removeChild(script); };
  }, []);

  useEffect(() => {
    if (!googleLoaded || !direccionInputRef.current) return;
    try {
      autocompleteRef.current = new window.google.maps.places.Autocomplete(
        direccionInputRef.current, { types: ["address"], componentRestrictions: { country: "us" } }
      );
      autocompleteRef.current.setFields(["formatted_address"]);
      autocompleteRef.current.addListener("place_changed", () => {
        const place = autocompleteRef.current.getPlace();
        if (place?.formatted_address) setForm(prev => ({ ...prev, direccion: place.formatted_address }));
      });
    } catch (error) { console.error("Error autocomplete:", error); }
  }, [googleLoaded]);

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    if (name === "servicios_adicionales") {
      let nuevos = [...form.servicios_adicionales];
      if (checked) nuevos.push(value);
      else nuevos = nuevos.filter(s => s !== value);
      setForm({ ...form, servicios_adicionales: nuevos });
    } else {
      setForm({ ...form, [name]: type === "number" ? Number(value) : value });
    }
    if (errores[name]) setErrores({ ...errores, [name]: "" });
  };

  const handleMenuChange = (item) => {
    setForm(prev => ({ ...prev, menu_seleccionado: item }));
    if (errores.menu) setErrores({ ...errores, menu: "" });
  };

  const serviciosSeleccionados = form.tipo && tiposDeCatering[form.tipo]?.servicios || [];
  const totalExtras = serviciosSeleccionados.filter(s => form.servicios_adicionales.includes(s.nombre)).reduce((t, s) => t + s.precio, 0);
  const costoMenu = form.menu_seleccionado ? form.menu_seleccionado.precio * (form.personas || 0) : 0;
  const totalGeneral = costoMenu + totalExtras;
  const creditoRestante = creditoTotal - totalGeneral;
  const cuotasSeleccionadas = Math.min(form.cuotas || 1, 6);
  const cuotaInicial = totalGeneral * 0.25;
  const cuotaMensual = cuotasSeleccionadas > 1 ? (totalGeneral - cuotaInicial) / (cuotasSeleccionadas - 1) : 0;

  const formatearHora = (hora) => hora?.length === 5 ? hora + ":00" : hora;

  const validarFormulario = () => {
    const err = {};
    const hoy = new Date().toISOString().split("T")[0];
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const telefonoRegex = /^[0-9]{10,}$/;
    
    if (!form.nombre.trim() || form.nombre.length < 3) err.nombre = "Nombre completo requerido (m√≠n 3 caracteres)";
    if (!emailRegex.test(form.email)) err.email = "Email v√°lido requerido";
    if (!telefonoRegex.test(form.telefono.replace(/[^0-9]/g, ""))) err.telefono = "Tel√©fono v√°lido requerido (10 d√≠gitos)";
    if (!form.tipo) err.tipo = "Selecciona tipo de evento";
    if (!form.direccion.trim()) err.direccion = "Direcci√≥n completa requerida";
    if (!form.fecha || form.fecha < hoy) err.fecha = "Fecha debe ser futura";
    if (!form.hora) err.hora = "Hora requerida";
    if (!form.personas || form.personas < 10) err.personas = "M√≠nimo 10 personas para catering";
    if (!form.menu_seleccionado) err.menu = "Selecciona un men√∫";
    if (!form.contacto_emergencia.trim()) err.contacto_emergencia = "Contacto de emergencia requerido";
    if (!telefonoRegex.test(form.telefono_emergencia.replace(/[^0-9]/g, ""))) err.telefono_emergencia = "Tel√©fono emergencia requerido";
    
    return err;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    const err = validarFormulario();
    if (Object.keys(err).length > 0) { 
      setErrores(err); 
      window.scrollTo({ top: 0, behavior: "smooth" });
      return; 
    }
    if (creditoRestante < 0) { 
      alert("Cr√©dito insuficiente para completar esta solicitud"); 
      return; 
    }

    setLoading(true);
    const usuario_id = "4d7c5276-9a75-4af4-9db6-36c5320f8806";
    
    const payload = {
      nombre: form.nombre, email: form.email, telefono: form.telefono, tipo: form.tipo,
      fecha: form.fecha, hora: formatearHora(form.hora), personas: Number(form.personas),
      direccion: form.direccion, notas: form.notas, cuotas: cuotasSeleccionadas,
      metodo_pago: form.metodo_pago, servicios_adicionales: form.servicios_adicionales.join(", "),
      total_extras: totalExtras, total_general: totalGeneral, credito_restante: creditoRestante,
      precio_base: costoMenu, usuario_id, evento: form.tipo,
      mensaje_restaurante: `EVENTO: ${form.tipo}\nMEN√ö: ${form.menu_seleccionado.nombre} ($${form.menu_seleccionado.precio}/persona)\nALERGIAS: ${form.alergias || "Ninguna"}\nINSTRUCCIONES: ${form.instrucciones_entrega || "N/A"}\nNOTAS: ${form.notas || "N/A"}\nEMERGENCIA: ${form.contacto_emergencia} - ${form.telefono_emergencia}`,
    };

    try {
      const { error } = await supabase.from("solicitudes_catering").insert([payload]).select();
      if (error) throw error;
      await supabase.from("usuarios").update({ credito: creditoRestante }).eq("id", usuario_id);
      setLoading(false); setConfirmado(true); setMostrarResumen(true);
    } catch (err) {
      console.error(err); 
      alert("Error al enviar: " + err.message); 
      setLoading(false);
    }
  };

  const generarPDF = () => {
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.text("DineFlexx - Solicitud Catering", 105, 20, { align: "center" });
    doc.setFontSize(11);
    let y = 35;
    doc.text(`Cliente: ${form.nombre}`, 20, y); y += 7;
    doc.text(`Email: ${form.email}`, 20, y); y += 7;
    doc.text(`Tel: ${form.telefono}`, 20, y); y += 7;
    doc.text(`Evento: ${form.tipo}`, 20, y); y += 10;
    doc.text(`Fecha: ${form.fecha} a las ${form.hora}`, 20, y); y += 7;
    doc.text(`Personas: ${form.personas}`, 20, y); y += 7;
    doc.text(`Direcci√≥n: ${form.direccion}`, 20, y); y += 10;
    doc.text(`Men√∫: ${form.menu_seleccionado?.nombre} - $${form.menu_seleccionado?.precio}/persona`, 20, y); y += 7;
    doc.text(`Total Men√∫: $${costoMenu.toFixed(2)}`, 20, y); y += 7;
    doc.text(`Servicios Extra: $${totalExtras.toFixed(2)}`, 20, y); y += 7;
    doc.text(`TOTAL: $${totalGeneral.toFixed(2)}`, 20, y); y += 10;
    doc.text(`Pago: ${form.metodo_pago} - ${cuotasSeleccionadas} cuotas`, 20, y); y += 7;
    doc.text(`Inicial (25%): $${cuotaInicial.toFixed(2)}`, 20, y); y += 7;
    if (cuotasSeleccionadas > 1) {
      doc.text(`Cuotas: $${cuotaMensual.toFixed(2)} x ${cuotasSeleccionadas - 1}`, 20, y); y += 10;
    }
    doc.text(`Emergencia: ${form.contacto_emergencia} - ${form.telefono_emergencia}`, 20, y); y += 7;
    if (form.alergias) { doc.text(`Alergias: ${form.alergias}`, 20, y); y += 7; }
    if (form.instrucciones_entrega) { doc.text(`Instrucciones: ${form.instrucciones_entrega}`, 20, y); }
    doc.save("catering_dineflexx.pdf");
  };
  if (confirmado) {
    return (
      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="min-h-screen bg-gradient-to-br from-emerald-50 to-teal-50 py-12 px-4">
        <div className="max-w-2xl mx-auto">
          <motion.button whileHover={{ scale: 1.05 }} onClick={() => navigate("/catering")} className="mb-8 flex items-center gap-2 text-teal-700 hover:text-teal-900 font-medium">
            <ArrowLeft className="w-5 h-5" /> Volver a Catering
          </motion.button>
          <motion.div initial={{ scale: 0.95 }} animate={{ scale: 1 }} className="bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl p-8 md:p-12 border border-white/50">
            <div className="text-center mb-10">
              <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} className="w-24 h-24 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-xl">
                <CheckCircle className="w-12 h-12 text-white" />
              </motion.div>
              <h1 className="text-3xl md:text-4xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent mb-4">¬°Solicitud Confirmada!</h1>
              <p className="text-xl text-gray-600">Tu evento est√° en camino üéâ</p>
            </div>
            {mostrarResumen && (
              <div className="space-y-6">
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl">
                    <h3 className="font-bold text-lg mb-4 flex items-center gap-2 text-blue-800"><User className="w-5 h-5" /> Cliente</h3>
                    <p className="text-sm mb-1"><strong>Nombre:</strong> {form.nombre}</p>
                    <p className="text-sm mb-1"><strong>Tel:</strong> {form.telefono}</p>
                    <p className="text-sm"><strong>Email:</strong> {form.email}</p>
                  </div>
                  <div className="p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl">
                    <h3 className="font-bold text-lg mb-4 flex items-center gap-2 text-purple-800"><Calendar className="w-5 h-5" /> Evento</h3>
                    <p className="text-sm mb-1"><strong>Tipo:</strong> {form.tipo}</p>
                    <p className="text-sm mb-1"><strong>Fecha:</strong> {form.fecha} {form.hora}</p>
                    <p className="text-sm"><strong>Personas:</strong> {form.personas}</p>
                  </div>
                </div>
                <div className="p-6 bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl">
                  <h3 className="font-bold text-xl mb-4 text-gray-800">Resumen Financiero</h3>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between py-2 border-b"><span>Men√∫ ({form.personas} personas)</span><span className="font-bold">${costoMenu.toFixed(2)}</span></div>
                    {totalExtras > 0 && <div className="flex justify-between py-2 border-b"><span>Servicios adicionales</span><span className="font-bold">${totalExtras.toFixed(2)}</span></div>}
                    <div className="flex justify-between py-3 text-xl font-bold"><span>Total</span><span className="text-emerald-600">${totalGeneral.toFixed(2)}</span></div>
                  </div>
                </div>
                <div className="flex flex-col sm:flex-row gap-4">
                  <motion.button whileHover={{ scale: 1.05 }} onClick={generarPDF} className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-4 px-6 rounded-2xl font-semibold shadow-lg flex items-center justify-center gap-2">
                    <Download className="w-5 h-5" /> Descargar PDF
                  </motion.button>
                  <motion.button whileHover={{ scale: 1.05 }} onClick={() => navigate("/catering")} className="flex-1 bg-gray-500 text-white py-4 px-6 rounded-2xl font-semibold shadow-lg">
                    Nuevo Evento
                  </motion.button>
                </div>
              </div>
            )}
          </motion.div>
        </div>
      </motion.div>
    );
  }

  return (
    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 py-8 px-4">
      <div className="max-w-3xl mx-auto">
        <div className="flex items-center justify-center mb-8">
          <div className="flex items-center gap-3">
            {[0, 1, 2].map(i => (
              <React.Fragment key={i}>
                <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-sm font-bold transition-all ${step >= i ? "bg-gradient-to-r from-purple-500 to-blue-500 text-white shadow-lg" : "bg-gray-200 text-gray-500"}`}>{i + 1}</div>
                {i < 2 && <div className={`w-16 h-1 rounded-full transition-all ${step > i ? "bg-gradient-to-r from-purple-500 to-blue-500" : "bg-gray-200"}`} />}
              </React.Fragment>
            ))}
          </div>
        </div>

        <motion.div initial={{ y: 20 }} animate={{ y: 0 }} className="bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-10 border border-white/50">
          <div className="text-center mb-8">
            <h1 className="text-3xl md:text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">Solicitud de Catering</h1>
            <p className="text-gray-600">Paso {step + 1} de 3 - Informaci√≥n completa del evento</p>
          </div>

          <form onSubmit={handleSubmit} className="space-y-6">
            <AnimatePresence mode="wait">
              {step === 0 && (
                <motion.div key="step0" initial={{ x: 50, opacity: 0 }} animate={{ x: 0, opacity: 1 }} exit={{ x: -50, opacity: 0 }} className="space-y-6">
                  <div className="text-center mb-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">Selecciona el Tipo de Evento</h2>
                    <p className="text-gray-600">Elige la categor√≠a que mejor se ajuste a tu celebraci√≥n</p>
                  </div>
                  <div className="grid md:grid-cols-3 gap-4">
                    {Object.keys(tiposDeCatering).map(tipo => (
                      <motion.div key={tipo} whileHover={{ y: -4, scale: 1.02 }} onClick={() => { setForm({ ...form, tipo }); setStep(1); }} className={`p-6 rounded-2xl cursor-pointer border-2 transition-all text-center ${form.tipo === tipo ? "border-purple-500 bg-gradient-to-br from-purple-50 to-blue-50 ring-2 ring-purple-200 shadow-xl" : "border-gray-200 hover:border-gray-300 hover:shadow-lg"}`}>
                        <div className="text-5xl mb-3">{tiposDeCatering[tipo].icon}</div>
                        <h3 className="font-bold text-xl mb-2 text-gray-800">{tipo}</h3>
                        <p className="text-sm text-gray-600">{tiposDeCatering[tipo].menu.length} men√∫s disponibles</p>
                      </motion.div>
                    ))}
                  </div>
                  {errores.tipo && <div className="flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700"><AlertCircle className="w-5 h-5" /><span>{errores.tipo}</span></div>}
                  <div className="flex justify-between pt-4">
                    <button type="button" onClick={() => navigate("/catering")} className="px-8 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 font-medium">Cancelar</button>
                  </div>
                </motion.div>
              )}

              {step === 1 && (
                <motion.div key="step1" initial={{ x: 50, opacity: 0 }} animate={{ x: 0, opacity: 1 }} exit={{ x: -50, opacity: 0 }} className="space-y-6">
                  <div className="p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl border border-purple-200 mb-6">
                    <div className="flex items-center gap-3">
                      <span className="text-3xl">{tiposDeCatering[form.tipo]?.icon}</span>
                      <div>
                        <p className="text-sm text-gray-600">Tipo de Evento Seleccionado</p>
                        <p className="text-xl font-bold text-purple-700">{form.tipo}</p>
                      </div>
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"><User className="w-4 h-4" /> Nombre Completo *</label>
                      <input type="text" name="nombre" value={form.nombre} onChange={handleChange} className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-purple-500 transition-all ${errores.nombre ? "border-red-500" : "border-gray-200"}`} placeholder="Nombre y apellido" />
                      {errores.nombre && <p className="text-red-500 text-xs mt-1">{errores.nombre}</p>}
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"><Phone className="w-4 h-4" /> Tel√©fono *</label>
                      <input type="tel" name="telefono" value={form.telefono} onChange={handleChange} className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-blue-500 transition-all ${errores.telefono ? "border-red-500" : "border-gray-200"}`} placeholder="787-123-4567" />
                      {errores.telefono && <p className="text-red-500 text-xs mt-1">{errores.telefono}</p>}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"><Mail className="w-4 h-4" /> Email *</label>
                    <input type="email" name="email" value={form.email} onChange={handleChange} className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-green-500 transition-all ${errores.email ? "border-red-500" : "border-gray-200"}`} placeholder="tu@email.com" />
                    {errores.email && <p className="text-red-500 text-xs mt-1">{errores.email}</p>}
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"><Calendar className="w-4 h-4" /> Fecha del Evento *</label>
                      <input type="date" name="fecha" value={form.fecha} onChange={handleChange} className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-orange-500 ${errores.fecha ? "border-red-500" : "border-gray-200"}`} />
                      {errores.fecha && <p className="text-red-500 text-xs mt-1">{errores.fecha}</p>}
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"><Clock className="w-4 h-4" /> Hora *</label>
                      <input type="time" name="hora" value={form.hora} onChange={handleChange} className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-orange-500 ${errores.hora ? "border-red-500" : "border-gray-200"}`} />
                      {errores.hora && <p className="text-red-500 text-xs mt-1">{errores.hora}</p>}
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"><Users className="w-4 h-4" /> N√∫mero de Personas *</label>
                      <input type="number" name="personas" value={form.personas} onChange={handleChange} min="10" className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-teal-500 ${errores.personas ? "border-red-500" : "border-gray-200"}`} placeholder="M√≠nimo 10" />
                      {errores.personas && <p className="text-red-500 text-xs mt-1">{errores.personas}</p>}
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"><MapPin className="w-4 h-4" /> Direcci√≥n del Evento *</label>
                      <input type="text" name="direccion" ref={direccionInputRef} value={form.direccion} onChange={handleChange} className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-teal-500 ${errores.direccion ? "border-red-500" : "border-gray-200"}`} placeholder="Busca direcci√≥n..." />
                      {errores.direccion && <p className="text-red-500 text-xs mt-1">{errores.direccion}</p>}
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Contacto de Emergencia *</label>
                      <input type="text" name="contacto_emergencia" value={form.contacto_emergencia} onChange={handleChange} className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-red-500 ${errores.contacto_emergencia ? "border-red-500" : "border-gray-200"}`} placeholder="Nombre contacto" />
                      {errores.contacto_emergencia && <p className="text-red-500 text-xs mt-1">{errores.contacto_emergencia}</p>}
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Tel√©fono Emergencia *</label>
                      <input type="tel" name="telefono_emergencia" value={form.telefono_emergencia} onChange={handleChange} className={`w-full p-4 border rounded-xl focus:ring-2 focus:ring-red-500 ${errores.telefono_emergencia ? "border-red-500" : "border-gray-200"}`} placeholder="787-XXX-XXXX" />
                      {errores.telefono_emergencia && <p className="text-red-500 text-xs mt-1">{errores.telefono_emergencia}</p>}
                    </div>
                  </div>

                  <div className="flex justify-between pt-4">
                    <button type="button" onClick={() => setStep(0)} className="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 font-medium">‚Üê Anterior</button>
                    <button type="button" onClick={() => setStep(2)} className="px-8 py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-xl shadow-lg font-semibold">Siguiente ‚Üí</button>
                  </div>
                </motion.div>
              )}

              {step === 2 && form.tipo && tiposDeCatering[form.tipo] && (
                <motion.div key="step2" initial={{ x: 50, opacity: 0 }} animate={{ x: 0, opacity: 1 }} exit={{ x: -50, opacity: 0 }} className="space-y-6">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-4 flex items-center gap-2"><FileText className="w-5 h-5" /> Selecciona Men√∫ *</label>
                    <div className="grid md:grid-cols-2 gap-4">
                      {tiposDeCatering[form.tipo].menu.map(item => {
                        const sel = form.menu_seleccionado?.nombre === item.nombre;
                        return (
                          <motion.div key={item.nombre} whileHover={{ y: -4 }} onClick={() => handleMenuChange(item)} className={`p-6 rounded-2xl cursor-pointer border-2 transition-all ${sel ? "border-purple-500 bg-purple-50 ring-2 ring-purple-200" : "border-gray-200 hover:border-gray-300"}`}>
                            <h4 className="font-bold text-lg mb-2">{item.nombre} <span className="text-purple-600">${item.precio}/p</span></h4>
                            <p className="text-sm text-gray-600 mb-3">{item.descripcion}</p>
                            {sel && <div className="p-2 bg-purple-100 rounded-lg text-xs font-medium text-purple-800">‚úì Total: ${(item.precio * (form.personas || 0)).toLocaleString()}</div>}
                          </motion.div>
                        );
                      })}
                    </div>
                    {errores.menu && <p className="text-red-500 text-sm mt-2">{errores.menu}</p>}
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-3">Servicios Adicionales</label>
                    <div className="grid md:grid-cols-2 gap-3">
                      {tiposDeCatering[form.tipo].servicios.map(({ nombre, precio }) => (
                        <label key={nombre} className="flex items-center p-4 border border-gray-200 rounded-xl hover:bg-gray-50 cursor-pointer">
                          <input type="checkbox" name="servicios_adicionales" value={nombre} checked={form.servicios_adicionales.includes(nombre)} onChange={handleChange} className="w-5 h-5 text-purple-600 rounded" />
                          <span className="ml-3 flex-1 text-sm"><span className="font-medium">{nombre}</span> <span className="text-emerald-600 font-bold">${precio}</span></span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Alergias o Restricciones Alimentarias</label>
                    <input type="text" name="alergias" value={form.alergias} onChange={handleChange} className="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-yellow-500" placeholder="Ej: Gluten, l√°cteos, mariscos..." />
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Instrucciones Especiales de Entrega</label>
                    <textarea name="instrucciones_entrega" value={form.instrucciones_entrega} onChange={handleChange} rows={2} className="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 resize-none" placeholder="Acceso, estacionamiento, contacto en el lugar..." />
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"><CreditCard className="w-4 h-4" /> M√©todo de Pago</label>
                      <select name="metodo_pago" value={form.metodo_pago} onChange={handleChange} className="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500">
                        <option>Tarjeta de cr√©dito</option>
                        <option>ATH M√≥vil</option>
                        <option>Efectivo</option>
                        <option>Cheque</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Cuotas: {form.cuotas}</label>
                      <input type="range" name="cuotas" value={form.cuotas} onChange={handleChange} min="1" max="6" className="w-full h-2 bg-gray-200 rounded-lg cursor-pointer accent-purple-500" />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Notas Adicionales</label>
                    <textarea name="notas" value={form.notas} onChange={handleChange} rows={3} className="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 resize-none" placeholder="Detalles especiales del evento..." />
                  </div>

                  <div className="p-6 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl border-2 border-emerald-200">
                    <h3 className="font-bold text-lg mb-4 text-emerald-800">üí∞ Resumen Final</h3>
                    <div className="space-y-2 text-sm">
                      {form.menu_seleccionado && <div className="flex justify-between py-2"><span>Men√∫ x{form.personas}</span><span className="font-bold">${costoMenu.toFixed(2)}</span></div>}
                      {totalExtras > 0 && <div className="flex justify-between py-2"><span>Servicios</span><span className="font-bold">${totalExtras.toFixed(2)}</span></div>}
                      <div className="flex justify-between py-3 bg-white rounded-xl px-4 shadow-sm border text-lg"><span className="font-bold">TOTAL</span><span className="font-bold text-emerald-700">${totalGeneral.toFixed(2)}</span></div>
                      <div className={`p-3 rounded-xl text-center font-bold ${creditoRestante >= 0 ? "bg-emerald-100 text-emerald-800" : "bg-red-100 text-red-800"}`}>Cr√©dito: ${creditoRestante.toFixed(2)}</div>
                      <div className="grid grid-cols-2 gap-2 mt-3">
                        <div className="text-xs text-center py-2 bg-emerald-100 rounded-lg"><span className="block font-bold text-emerald-800">${cuotaInicial.toFixed(2)}</span>Inicial 25%</div>
                        {cuotasSeleccionadas > 1 && <div className="text-xs text-center py-2 bg-blue-100 rounded-lg"><span className="block font-bold text-blue-800">${cuotaMensual.toFixed(2)}</span>{cuotasSeleccionadas - 1}x mensual</div>}
                      </div>
                    </div>
                  </div>

                  <div className="flex justify-between pt-4">
                    <button type="button" onClick={() => setStep(1)} className="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 font-semibold">‚Üê Anterior</button>
                    <button type="submit" disabled={loading || creditoRestante < 0} className={`px-10 py-4 rounded-xl font-bold shadow-lg flex items-center gap-2 ${loading || creditoRestante < 0 ? "bg-gray-400 cursor-not-allowed" : "bg-gradient-to-r from-purple-500 to-blue-500 text-white hover:shadow-xl"}`}>
                      {loading ? <><div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" /> Enviando...</> : "Confirmar Solicitud ‚Üí"}
                    </button>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          </form>
        </motion.div>
      </div>
    </motion.div>
  );
}
